/*
	// MATGlobalCommonFunctionsQDM lines [7:1-7:82]
	valueset "Emergency Department Visit": 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292' 
*/
{% macro MATGlobalCommonFunctionsQDMEmergency_Department_Visit() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' }{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [8:1-8:71]
	valueset "Encounter Inpatient": 'urn:oid:2.16.840.1.113883.3.666.5.307' 
*/
{% macro MATGlobalCommonFunctionsQDMEncounter_Inpatient() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' }{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [9:1-9:72]
	valueset "Intensive Care Unit": 'urn:oid:2.16.840.1.113762.1.4.1029.206' 
*/
{% macro MATGlobalCommonFunctionsQDMIntensive_Care_Unit() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1029.206', 'referenceName': 'MATGlobalCommonFunctionsQDMIntensive Care Unit' }{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [10:1-10:73]
	valueset "Observation Services": 'urn:oid:2.16.840.1.113762.1.4.1111.143' 
*/
{% macro MATGlobalCommonFunctionsQDMObservation_Services() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' }{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [11:1-11:78]
	valueset "Outpatient Surgery Service": 'urn:oid:2.16.840.1.113762.1.4.1110.38' 
*/
{% macro MATGlobalCommonFunctionsQDMOutpatient_Surgery_Service() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1110.38', 'referenceName': 'MATGlobalCommonFunctionsQDMOutpatient Surgery Service' }{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [15:1-15:15]
	context Patient
*/
{% macro MATGlobalCommonFunctionsQDMPatient(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [17:1-18:56]
	define "ED Encounter":
	  ["Encounter, Performed": "Emergency Department Visit"]
*/
{% macro MATGlobalCommonFunctionsQDMED_Encounter(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMED Encounter', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [20:1-22:83]
	define "Inpatient Encounter":
	  ["Encounter, Performed": "Encounter Inpatient"] EncounterInpatient
	    where EncounterInpatient.relevantPeriod ends during day of "Measurement Period"
*/
{% macro MATGlobalCommonFunctionsQDMInpatient_Encounter(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' } } } }] } }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [29:1-30:62]
	define function "ToDateInterval"(period Interval<DateTime> ):
	  Interval[date from start of period, date from end of period]
*/
{% macro MATGlobalCommonFunctionsQDMToDateInterval(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMToDateInterval', 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.DateFrom, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'low': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}Date' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [33:1-34:60]
	define function "LengthInDays"(Value Interval<DateTime> ):
	  difference in days between start of Value and end of Value
*/
{% macro MATGlobalCommonFunctionsQDMLengthInDays(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMLengthInDays', 'child': { 'operator': environment.DifferenceBetween, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [37:1-45:71]
	define function "HospitalizationLocations"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return if EDVisit is null then Visit.facilityLocations 
	  		else flatten { EDVisit.facilityLocations, Visit.facilityLocations }
*/
{% macro MATGlobalCommonFunctionsQDMHospitalizationLocations(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [48:1-52:18]
	define function "EmergencyDepartmentArrivalTime"(Encounter "Encounter, Performed" ):
	  start of First(("HospitalizationLocations"(Encounter))HospitalLocation
	  		where HospitalLocation.code in "Emergency Department Visit"
	  		sort by start of locationPeriod
	  ).locationPeriod
*/
{% macro MATGlobalCommonFunctionsQDMEmergencyDepartmentArrivalTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergencyDepartmentArrivalTime', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'locationPeriod', 'child': { 'operator': environment.First, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'HospitalLocation', 'path': 'code' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHospitalizationLocations', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }] } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [65:1-73:31]
	define function "Hospitalization"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return Interval[Coalesce(start of EDVisit.relevantPeriod, start of Visit.relevantPeriod), 
	  	end of Visit.relevantPeriod]
*/
{% macro MATGlobalCommonFunctionsQDMHospitalization(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalization', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [55:1-56:39]
	define function "HospitalAdmissionTime"(Encounter "Encounter, Performed" ):
	  start of "Hospitalization"(Encounter)
*/
{% macro MATGlobalCommonFunctionsQDMHospitalAdmissionTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalAdmissionTime', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHospitalization', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalization', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [59:1-62:18]
	define function "HospitalArrivalTime"(Encounter "Encounter, Performed" ):
	  start of First(("HospitalizationLocations"(Encounter))HospitalLocation
	  		sort by start of locationPeriod
	  ).locationPeriod
*/
{% macro MATGlobalCommonFunctionsQDMHospitalArrivalTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalArrivalTime', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'locationPeriod', 'child': { 'operator': environment.First, 'child': { 'operator': environment.Query, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHospitalizationLocations', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }] } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [76:1-77:44]
	define function "HospitalizationLengthofStay"(Encounter "Encounter, Performed" ):
	  LengthInDays("Hospitalization"(Encounter))
*/
{% macro MATGlobalCommonFunctionsQDMHospitalizationLengthofStay(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationLengthofStay', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMLengthInDays', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMLengthInDays', 'child': { 'operator': environment.DifferenceBetween, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHospitalization', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalization', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [80:1-83:18]
	define function "HospitalDepartureTime"(Encounter "Encounter, Performed" ):
	  end of Last(("HospitalizationLocations"(Encounter))HospitalLocation
	  		sort by start of locationPeriod
	  ).locationPeriod
*/
{% macro MATGlobalCommonFunctionsQDMHospitalDepartureTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalDepartureTime', 'child': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'locationPeriod', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHospitalizationLocations', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }] } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [86:1-87:33]
	define function "HospitalDischargeTime"(Encounter "Encounter, Performed" ):
	  end of Encounter.relevantPeriod
*/
{% macro MATGlobalCommonFunctionsQDMHospitalDischargeTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalDischargeTime', 'child': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [90:1-110:31]
	define function "HospitalizationWithObservationAndOutpatientSurgeryService"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let ObsVisit: Last(["Encounter, Performed": "Observation Services"] LastObs
	  			where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	),
	  	VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
	  	EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
	  			sort by 
	  			end of relevantPeriod
	  	),
	  	VisitStartWithED: Coalesce(start of EDVisit.relevantPeriod, VisitStart),
	  	OutpatientSurgeryVisit: Last(["Encounter, Performed": "Outpatient Surgery Service"] LastSurgeryOP
	  			where LastSurgeryOP.relevantPeriod ends 1 hour or less on or before VisitStartWithED
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return Interval[Coalesce(start of OutpatientSurgeryVisit.relevantPeriod, VisitStartWithED), 
	  	end of Visit.relevantPeriod]
*/
{% macro MATGlobalCommonFunctionsQDMHospitalizationWithObservationAndOutpatientSurgeryService(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationWithObservationAndOutpatientSurgeryService', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'OutpatientSurgeryVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'OutpatientSurgeryVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastSurgeryOP', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastSurgeryOP', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMOutpatient_Surgery_Service', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1110.38', 'referenceName': 'MATGlobalCommonFunctionsQDMOutpatient Surgery Service' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } }, { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } }, { 'operator': environment.LetClause, 'referenceName': 'OutpatientSurgeryVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastSurgeryOP', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastSurgeryOP', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMOutpatient_Surgery_Service', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1110.38', 'referenceName': 'MATGlobalCommonFunctionsQDMOutpatient Surgery Service' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [113:1-127:31]
	define function "HospitalizationWithObservation"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let ObsVisit: Last(["Encounter, Performed": "Observation Services"] LastObs
	  			where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	),
	  	VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
	  	EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
	  	end of Visit.relevantPeriod]
*/
{% macro MATGlobalCommonFunctionsQDMHospitalizationWithObservation(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationWithObservation', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } }, { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [130:1-131:61]
	define function "HospitalizationWithObservationLengthofStay"(Encounter "Encounter, Performed" ):
	  "LengthInDays"("HospitalizationWithObservation"(Encounter))
*/
{% macro MATGlobalCommonFunctionsQDMHospitalizationWithObservationLengthofStay(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationWithObservationLengthofStay', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMLengthInDays', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMLengthInDays', 'child': { 'operator': environment.DifferenceBetween, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHospitalizationWithObservation', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationWithObservation', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } }, { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [134:1-139:3]
	define function "FirstInpatientIntensiveCareUnit"(Encounter "Encounter, Performed" ):
	  First((Encounter.facilityLocations)HospitalLocation
	      where HospitalLocation.code in "Intensive Care Unit"
	        and HospitalLocation.locationPeriod during Encounter.relevantPeriod
	      sort by start of locationPeriod
	  )
*/
{% macro MATGlobalCommonFunctionsQDMFirstInpatientIntensiveCareUnit(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMFirstInpatientIntensiveCareUnit', 'child': { 'operator': environment.First, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'HospitalLocation', 'path': 'code' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMIntensive_Care_Unit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1029.206', 'referenceName': 'MATGlobalCommonFunctionsQDMIntensive Care Unit' } } }, 'right': { 'operator': environment.IncludedIn, 'left': { 'operator': environment.Property, 'scope': 'HospitalLocation', 'path': 'locationPeriod' }, 'right': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } } }] } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [142:1-145:35]
	define function "NormalizeInterval"(pointInTime DateTime, period Interval<DateTime> ):
	  if pointInTime is not null then Interval[pointInTime, pointInTime]
	    else if period is not null then period 
	    else null as Interval<DateTime>
*/
{% macro MATGlobalCommonFunctionsQDMNormalizeInterval(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [148:1-151:3]
	define function "HasStart"(period Interval<DateTime> ):
	  not ( start of period is null
	      or start of period = minimum DateTime
	  )
*/
{% macro MATGlobalCommonFunctionsQDMHasStart(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHasStart', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MinValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [154:1-159:3]
	define function "HasEnd"(period Interval<DateTime> ):
	  not ( 
	    end of period is null
	      or 
	      end of period = maximum DateTime
	  )
*/
{% macro MATGlobalCommonFunctionsQDMHasEnd(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHasEnd', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MaxValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [162:1-165:24]
	define function "Latest"(period Interval<DateTime> ):
	  if ( HasEnd(period)) then 
	  end of period 
	    else start of period
*/
{% macro MATGlobalCommonFunctionsQDMLatest(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMLatest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHasEnd', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHasEnd', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MaxValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [168:1-171:15]
	define function "Earliest"(period Interval<DateTime> ):
	  if ( HasStart(period)) then start of period 
	    else 
	  end of period
*/
{% macro MATGlobalCommonFunctionsQDMEarliest(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMEarliest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHasStart', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHasStart', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MinValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [174:1-175:48]
	define function "LatestOf"(pointInTime DateTime, period Interval<DateTime> ):
	  Latest(NormalizeInterval(pointInTime, period))
*/
{% macro MATGlobalCommonFunctionsQDMLatestOf(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMLatestOf', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMLatest', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMLatest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHasEnd', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHasEnd', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MaxValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctionsQDM lines [178:1-179:50]
	define function "EarliestOf"(pointInTime DateTime, period Interval<DateTime> ):
	  Earliest(NormalizeInterval(pointInTime, period))
*/
{% macro MATGlobalCommonFunctionsQDMEarliestOf(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMEarliestOf', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEarliest', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMEarliest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHasStart', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHasStart', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MinValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
