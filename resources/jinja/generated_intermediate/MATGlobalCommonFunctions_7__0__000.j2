/*
	// MATGlobalCommonFunctions lines [5:1-5:82]
	valueset "Emergency Department Visit": 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292' 
*/
{% macro MATGlobalCommonFunctionsEmergency_Department_Visit() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' }{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [6:1-6:71]
	valueset "Encounter Inpatient": 'urn:oid:2.16.840.1.113883.3.666.5.307' 
*/
{% macro MATGlobalCommonFunctionsEncounter_Inpatient() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsEncounter Inpatient' }{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [7:1-7:72]
	valueset "Intensive Care Unit": 'urn:oid:2.16.840.1.113762.1.4.1029.206' 
*/
{% macro MATGlobalCommonFunctionsIntensive_Care_Unit() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1029.206', 'referenceName': 'MATGlobalCommonFunctionsIntensive Care Unit' }{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [8:1-8:73]
	valueset "Observation Services": 'urn:oid:2.16.840.1.113762.1.4.1111.143' 
*/
{% macro MATGlobalCommonFunctionsObservation_Services() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' }{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [9:1-9:78]
	valueset "Outpatient Surgery Service": 'urn:oid:2.16.840.1.113762.1.4.1110.38' 
*/
{% macro MATGlobalCommonFunctionsOutpatient_Surgery_Service() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1110.38', 'referenceName': 'MATGlobalCommonFunctionsOutpatient Surgery Service' }{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [13:1-13:15]
	context Patient
*/
{% macro MATGlobalCommonFunctionsPatient(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [15:1-16:56]
	define "ED Encounter":
	  ["Encounter, Performed": "Emergency Department Visit"]
*/
{% macro MATGlobalCommonFunctionsED_Encounter(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsED Encounter', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [32:1-33:60]
	define function "LengthInDays"(Value Interval<DateTime> ):
	  difference in days between start of Value and end of Value
*/
{% macro MATGlobalCommonFunctionsLengthInDays(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsLengthInDays', 'child': { 'operator': environment.DifferenceBetween, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [18:1-21:83]
	define "Inpatient Encounter":
	  ["Encounter, Performed": "Encounter Inpatient"] EncounterInpatient
	    where "LengthInDays"(EncounterInpatient.relevantPeriod)<= 120
	      and EncounterInpatient.relevantPeriod ends during day of "Measurement Period"
*/
{% macro MATGlobalCommonFunctionsInpatient_Encounter(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.LessOrEqual, 'left': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsLengthInDays', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsLengthInDays', 'child': { 'operator': environment.DifferenceBetween, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' }] }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '120' } }, 'right': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsEncounter Inpatient' } } } }] } }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [28:1-29:62]
	define function "ToDateInterval"(period Interval<DateTime> ):
	  Interval[date from start of period, date from end of period]
*/
{% macro MATGlobalCommonFunctionsToDateInterval(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsToDateInterval', 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.DateFrom, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'low': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}Date' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [36:1-44:71]
	define function "HospitalizationLocations"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return if EDVisit is null then Visit.facilityLocations 
	  		else flatten { EDVisit.facilityLocations, Visit.facilityLocations }
*/
{% macro MATGlobalCommonFunctionsHospitalizationLocations(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [47:1-51:18]
	define function "EmergencyDepartmentArrivalTime"(Encounter "Encounter, Performed" ):
	  start of First(("HospitalizationLocations"(Encounter))HospitalLocation
	  		where HospitalLocation.code in "Emergency Department Visit"
	  		sort by start of locationPeriod
	  ).locationPeriod
*/
{% macro MATGlobalCommonFunctionsEmergencyDepartmentArrivalTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsEmergencyDepartmentArrivalTime', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'locationPeriod', 'child': { 'operator': environment.First, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'HospitalLocation', 'path': 'code' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHospitalizationLocations', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }] } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [64:1-72:31]
	define function "Hospitalization"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return Interval[Coalesce(start of EDVisit.relevantPeriod, start of Visit.relevantPeriod), 
	  	end of Visit.relevantPeriod]
*/
{% macro MATGlobalCommonFunctionsHospitalization(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalization', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [54:1-55:39]
	define function "HospitalAdmissionTime"(Encounter "Encounter, Performed" ):
	  start of "Hospitalization"(Encounter)
*/
{% macro MATGlobalCommonFunctionsHospitalAdmissionTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalAdmissionTime', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHospitalization', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalization', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [58:1-61:18]
	define function "HospitalArrivalTime"(Encounter "Encounter, Performed" ):
	  start of First(("HospitalizationLocations"(Encounter))HospitalLocation
	  		sort by start of locationPeriod
	  ).locationPeriod
*/
{% macro MATGlobalCommonFunctionsHospitalArrivalTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalArrivalTime', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'locationPeriod', 'child': { 'operator': environment.First, 'child': { 'operator': environment.Query, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHospitalizationLocations', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }] } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [75:1-76:44]
	define function "HospitalizationLengthofStay"(Encounter "Encounter, Performed" ):
	  LengthInDays("Hospitalization"(Encounter))
*/
{% macro MATGlobalCommonFunctionsHospitalizationLengthofStay(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationLengthofStay', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsLengthInDays', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsLengthInDays', 'child': { 'operator': environment.DifferenceBetween, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHospitalization', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalization', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [79:1-82:18]
	define function "HospitalDepartureTime"(Encounter "Encounter, Performed" ):
	  end of Last(("HospitalizationLocations"(Encounter))HospitalLocation
	  		sort by start of locationPeriod
	  ).locationPeriod
*/
{% macro MATGlobalCommonFunctionsHospitalDepartureTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalDepartureTime', 'child': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'locationPeriod', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHospitalizationLocations', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationLocations', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.If, 'condition': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, 'then': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }, 'else': { 'operator': environment.Flatten, 'child': { 'operator': environment.List, 'children': [{ 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } }, { 'operator': environment.Property, 'scope': 'Visit', 'path': 'facilityLocations' }] } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}FacilityLocation' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] } }] } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [85:1-86:33]
	define function "HospitalDischargeTime"(Encounter "Encounter, Performed" ):
	  end of Encounter.relevantPeriod
*/
{% macro MATGlobalCommonFunctionsHospitalDischargeTime(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalDischargeTime', 'child': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [89:1-109:31]
	define function "HospitalizationWithObservationAndOutpatientSurgeryService"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let ObsVisit: Last(["Encounter, Performed": "Observation Services"] LastObs
	  			where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	),
	  	VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
	  	EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
	  			sort by 
	  			end of relevantPeriod
	  	),
	  	VisitStartWithED: Coalesce(start of EDVisit.relevantPeriod, VisitStart),
	  	OutpatientSurgeryVisit: Last(["Encounter, Performed": "Outpatient Surgery Service"] LastSurgeryOP
	  			where LastSurgeryOP.relevantPeriod ends 1 hour or less on or before VisitStartWithED
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return Interval[Coalesce(start of OutpatientSurgeryVisit.relevantPeriod, VisitStartWithED), 
	  	end of Visit.relevantPeriod]
*/
{% macro MATGlobalCommonFunctionsHospitalizationWithObservationAndOutpatientSurgeryService(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationWithObservationAndOutpatientSurgeryService', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'OutpatientSurgeryVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'OutpatientSurgeryVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastSurgeryOP', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastSurgeryOP', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsOutpatient_Surgery_Service', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1110.38', 'referenceName': 'MATGlobalCommonFunctionsOutpatient Surgery Service' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } }, { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } }, { 'operator': environment.LetClause, 'referenceName': 'OutpatientSurgeryVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastSurgeryOP', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStartWithED', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStartWithED', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastSurgeryOP', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsOutpatient_Surgery_Service', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1110.38', 'referenceName': 'MATGlobalCommonFunctionsOutpatient Surgery Service' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [112:1-126:31]
	define function "HospitalizationWithObservation"(Encounter "Encounter, Performed" ):
	  Encounter Visit
	  	let ObsVisit: Last(["Encounter, Performed": "Observation Services"] LastObs
	  			where LastObs.relevantPeriod ends 1 hour or less on or before start of Visit.relevantPeriod
	  			sort by 
	  			end of relevantPeriod
	  	),
	  	VisitStart: Coalesce(start of ObsVisit.relevantPeriod, start of Visit.relevantPeriod),
	  	EDVisit: Last(["Encounter, Performed": "Emergency Department Visit"] LastED
	  			where LastED.relevantPeriod ends 1 hour or less on or before VisitStart
	  			sort by 
	  			end of relevantPeriod
	  	)
	  	return Interval[Coalesce(start of EDVisit.relevantPeriod, VisitStart), 
	  	end of Visit.relevantPeriod]
*/
{% macro MATGlobalCommonFunctionsHospitalizationWithObservation(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationWithObservation', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } }, { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [129:1-130:61]
	define function "HospitalizationWithObservationLengthofStay"(Encounter "Encounter, Performed" ):
	  "LengthInDays"("HospitalizationWithObservation"(Encounter))
*/
{% macro MATGlobalCommonFunctionsHospitalizationWithObservationLengthofStay(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationWithObservationLengthofStay', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsLengthInDays', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsLengthInDays', 'child': { 'operator': environment.DifferenceBetween, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'Value', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Value', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHospitalizationWithObservation', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHospitalizationWithObservation', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } }, { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [133:1-138:3]
	define function "FirstInpatientIntensiveCareUnit"(Encounter "Encounter, Performed" ):
	  First((Encounter.facilityLocations)HospitalLocation
	      where HospitalLocation.code in "Intensive Care Unit"
	        and HospitalLocation.locationPeriod during Encounter.relevantPeriod
	      sort by start of locationPeriod
	  )
*/
{% macro MATGlobalCommonFunctionsFirstInpatientIntensiveCareUnit(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsFirstInpatientIntensiveCareUnit', 'child': { 'operator': environment.First, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'HospitalLocation', 'path': 'code' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsIntensive_Care_Unit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1029.206', 'referenceName': 'MATGlobalCommonFunctionsIntensive Care Unit' } } }, 'right': { 'operator': environment.IncludedIn, 'left': { 'operator': environment.Property, 'scope': 'HospitalLocation', 'path': 'locationPeriod' }, 'right': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.Start, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'locationPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'HospitalLocation', 'child': { 'operator': environment.Property, 'scope': none, 'path': 'facilityLocations', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } } }] } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [141:1-144:35]
	define function "NormalizeInterval"(pointInTime DateTime, period Interval<DateTime> ):
	  if pointInTime is not null then Interval[pointInTime, pointInTime]
	    else if period is not null then period 
	    else null as Interval<DateTime>
*/
{% macro MATGlobalCommonFunctionsNormalizeInterval(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [147:1-150:3]
	define function "HasStart"(period Interval<DateTime> ):
	  not ( start of period is null
	      or start of period = minimum DateTime
	  )
*/
{% macro MATGlobalCommonFunctionsHasStart(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHasStart', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MinValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [153:1-158:3]
	define function "HasEnd"(period Interval<DateTime> ):
	  not ( 
	    end of period is null
	      or 
	      end of period = maximum DateTime
	  )
*/
{% macro MATGlobalCommonFunctionsHasEnd(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHasEnd', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MaxValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [161:1-164:24]
	define function "Latest"(period Interval<DateTime> ):
	  if ( HasEnd(period)) then 
	  end of period 
	    else start of period
*/
{% macro MATGlobalCommonFunctionsLatest(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsLatest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHasEnd', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHasEnd', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MaxValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [167:1-170:15]
	define function "Earliest"(period Interval<DateTime> ):
	  if ( HasStart(period)) then start of period 
	    else 
	  end of period
*/
{% macro MATGlobalCommonFunctionsEarliest(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsEarliest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHasStart', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHasStart', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MinValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [173:1-174:48]
	define function "LatestOf"(pointInTime DateTime, period Interval<DateTime> ):
	  Latest(NormalizeInterval(pointInTime, period))
*/
{% macro MATGlobalCommonFunctionsLatestOf(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsLatestOf', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsLatest', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsLatest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHasEnd', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHasEnd', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MaxValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
/*
	// MATGlobalCommonFunctions lines [177:1-178:50]
	define function "EarliestOf"(pointInTime DateTime, period Interval<DateTime> ):
	  Earliest(NormalizeInterval(pointInTime, period))
*/
{% macro MATGlobalCommonFunctionsEarliestOf(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsEarliestOf', 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsEarliest', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsEarliest', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsHasStart', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsHasStart', 'child': { 'operator': environment.Not, 'child': { 'operator': environment.Or, 'left': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'right': { 'operator': environment.Equal, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'right': { 'operator': environment.MinValue } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }, 'then': { 'operator': environment.Start, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'else': { 'operator': environment.End, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }] }] }, 'typeSpecifier': { 'operator': environment.Disabled }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }) }}{% endmacro %}
