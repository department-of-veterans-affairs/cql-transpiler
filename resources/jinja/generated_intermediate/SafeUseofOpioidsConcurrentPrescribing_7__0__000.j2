/*
	// SafeUseofOpioidsConcurrentPrescribing lines [7:1-7:72]
	valueset "Cancer Related Pain": 'urn:oid:2.16.840.1.113762.1.4.1111.180'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingCancer_Related_Pain() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.180', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingCancer Related Pain' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [8:1-8:87]
	valueset "Discharge To Acute Care Facility": 'urn:oid:2.16.840.1.113883.3.117.1.7.1.87'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingDischarge_To_Acute_Care_Facility() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.87', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingDischarge To Acute Care Facility' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [9:1-9:58]
	valueset "Ethnicity": 'urn:oid:2.16.840.1.114222.4.11.837'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingEthnicity() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.114222.4.11.837', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingEthnicity' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [10:1-10:87]
	valueset "Hospice Care Referral or Admission": 'urn:oid:2.16.840.1.113762.1.4.1116.365'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingHospice_Care_Referral_or_Admission() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1116.365', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingHospice Care Referral or Admission' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [11:1-11:83]
	valueset "Left Against Medical Advice": 'urn:oid:2.16.840.1.113883.3.117.1.7.1.308'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingLeft_Against_Medical_Advice() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.308', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingLeft Against Medical Advice' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [12:1-12:95]
	valueset "Medications for Opioid Use Disorder (MOUD)": 'urn:oid:2.16.840.1.113762.1.4.1046.269'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingMedications_for_Opioid_Use_Disorder__LP_MOUD_RP_() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.269', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingMedications for Opioid Use Disorder (MOUD)' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [13:1-13:68]
	valueset "ONC Administrative Sex": 'urn:oid:2.16.840.1.113762.1.4.1'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingONC_Administrative_Sex() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingONC Administrative Sex' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [14:1-14:95]
	valueset "Opioid Medication Assisted Treatment (MAT)": 'urn:oid:2.16.840.1.113762.1.4.1111.177'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingOpioid_Medication_Assisted_Treatment__LP_MAT_RP_() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.177', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingOpioid Medication Assisted Treatment (MAT)' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [15:1-15:72]
	valueset "Opioid Use Disorder": 'urn:oid:2.16.840.1.113762.1.4.1111.171'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingOpioid_Use_Disorder() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.171', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingOpioid Use Disorder' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [16:1-16:79]
	valueset "Palliative or Hospice Care": 'urn:oid:2.16.840.1.113883.3.600.1.1579'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingPalliative_or_Hospice_Care() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.600.1.1579', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPalliative or Hospice Care' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [17:1-17:71]
	valueset "Patient Expired": 'urn:oid:2.16.840.1.113883.3.117.1.7.1.309'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingPatient_Expired() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.309', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient Expired' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [18:1-18:60]
	valueset "Payer Type": 'urn:oid:2.16.840.1.114222.4.11.3591'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingPayer_Type() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.114222.4.11.3591', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPayer Type' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [19:1-19:53]
	valueset "Race": 'urn:oid:2.16.840.1.114222.4.11.836'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingRace() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.114222.4.11.836', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingRace' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [20:1-20:95]
	valueset "Schedule II, III and IV Opioid Medications": 'urn:oid:2.16.840.1.113762.1.4.1046.241'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [21:1-21:78]
	valueset "Schedule IV Benzodiazepines": 'urn:oid:2.16.840.1.113762.1.4.1125.1'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingSchedule_IV_Benzodiazepines() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1125.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule IV Benzodiazepines' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [22:1-22:96]
	valueset "Sickle Cell Disease with and without Crisis": 'urn:oid:2.16.840.1.113762.1.4.1111.175'
*/
{% macro SafeUseofOpioidsConcurrentPrescribingSickle_Cell_Disease_with_and_without_Crisis() %}{ 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.175', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSickle Cell Disease with and without Crisis' }{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [26:1-26:15]
	context Patient
*/
{% macro SafeUseofOpioidsConcurrentPrescribingPatient(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [31:1-33:90]
	define "Inpatient Encounter with Age Greater than or Equal to 18":
	  Global."Inpatient Encounter" InpatientHospitalEncounter
	    where AgeInYearsAt(date from start of InpatientHospitalEncounter.relevantPeriod) >= 18
*/
{% macro SafeUseofOpioidsConcurrentPrescribingInpatient_Encounter_with_Age_Greater_than_or_Equal_to_18(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounter with Age Greater than or Equal to 18', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.GreaterOrEqual, 'left': { 'operator': environment.CalculateAgeAt, 'left': { 'operator': environment.ToDate, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'birthDatetime', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } } } } }, 'right': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'InpatientHospitalEncounter', 'path': 'relevantPeriod' } } } }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '18' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientHospitalEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMInpatient_Encounter', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' } } } }] } } } }] } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [89:1-95:120]
	define "Inpatient Encounters with an Opioid or Benzodiazepine at Discharge":
	  /*Captures encounters of patients with an opioid(s), benzodiazepine, or a combination of these medications at discharge*/
	  
	  "Inpatient Encounter with Age Greater than or Equal to 18" InpatientEncounter
	    with ( ["Medication, Discharge": "Schedule II, III and IV Opioid Medications"]
	      union ["Medication, Discharge": "Schedule IV Benzodiazepines"] ) OpioidOrBenzodiazepineDischargeMedication
	      such that OpioidOrBenzodiazepineDischargeMedication.authorDatetime during day of InpatientEncounter.relevantPeriod
*/
{% macro SafeUseofOpioidsConcurrentPrescribingInpatient_Encounters_with_an_Opioid_or_Benzodiazepine_at_Discharge(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounters with an Opioid or Benzodiazepine at Discharge', 'child': { 'operator': environment.Query, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounter_with_Age_Greater_than_or_Equal_to_18', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounter with Age Greater than or Equal to 18', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.GreaterOrEqual, 'left': { 'operator': environment.CalculateAgeAt, 'left': { 'operator': environment.ToDate, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'birthDatetime', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } } } } }, 'right': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'InpatientHospitalEncounter', 'path': 'relevantPeriod' } } } }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '18' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientHospitalEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMInpatient_Encounter', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' } } } }] } } } }] } } } }], 'relationshipClauseList': [{ 'operator': environment.With, 'alias': 'OpioidOrBenzodiazepineDischargeMedication', 'child': { 'operator': environment.Union, 'mixed': 'false', 'children': [{ 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' } } }, { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_IV_Benzodiazepines', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1125.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule IV Benzodiazepines' } } }] }, 'suchThat': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'OpioidOrBenzodiazepineDischargeMedication', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } } }] } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [39:1-40:70]
	define "Initial Population":
	  "Inpatient Encounters with an Opioid or Benzodiazepine at Discharge"
*/
{% macro SafeUseofOpioidsConcurrentPrescribingInitial_Population(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInitial Population', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounters_with_an_Opioid_or_Benzodiazepine_at_Discharge', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounters with an Opioid or Benzodiazepine at Discharge', 'child': { 'operator': environment.Query, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounter_with_Age_Greater_than_or_Equal_to_18', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounter with Age Greater than or Equal to 18', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.GreaterOrEqual, 'left': { 'operator': environment.CalculateAgeAt, 'left': { 'operator': environment.ToDate, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'birthDatetime', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } } } } }, 'right': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'InpatientHospitalEncounter', 'path': 'relevantPeriod' } } } }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '18' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientHospitalEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMInpatient_Encounter', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' } } } }] } } } }] } } } }], 'relationshipClauseList': [{ 'operator': environment.With, 'alias': 'OpioidOrBenzodiazepineDischargeMedication', 'child': { 'operator': environment.Union, 'mixed': 'false', 'children': [{ 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' } } }, { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_IV_Benzodiazepines', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1125.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule IV Benzodiazepines' } } }] }, 'suchThat': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'OpioidOrBenzodiazepineDischargeMedication', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } } }] } } } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [28:1-29:22]
	define "Denominator":
	  "Initial Population"
*/
{% macro SafeUseofOpioidsConcurrentPrescribingDenominator(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingDenominator', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInitial_Population', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInitial Population', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounters_with_an_Opioid_or_Benzodiazepine_at_Discharge', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounters with an Opioid or Benzodiazepine at Discharge', 'child': { 'operator': environment.Query, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounter_with_Age_Greater_than_or_Equal_to_18', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounter with Age Greater than or Equal to 18', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.GreaterOrEqual, 'left': { 'operator': environment.CalculateAgeAt, 'left': { 'operator': environment.ToDate, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'birthDatetime', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } } } } }, 'right': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'InpatientHospitalEncounter', 'path': 'relevantPeriod' } } } }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '18' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientHospitalEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMInpatient_Encounter', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' } } } }] } } } }] } } } }], 'relationshipClauseList': [{ 'operator': environment.With, 'alias': 'OpioidOrBenzodiazepineDischargeMedication', 'child': { 'operator': environment.Union, 'mixed': 'false', 'children': [{ 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' } } }, { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_IV_Benzodiazepines', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1125.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule IV Benzodiazepines' } } }] }, 'suchThat': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'OpioidOrBenzodiazepineDischargeMedication', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } } }] } } } } } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [35:1-37:67]
	define "Intervention Palliative or Hospice Care":
	  ["Intervention, Order": "Palliative or Hospice Care"]
	    union ["Intervention, Performed": "Palliative or Hospice Care"]
*/
{% macro SafeUseofOpioidsConcurrentPrescribingIntervention_Palliative_or_Hospice_Care(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingIntervention Palliative or Hospice Care', 'child': { 'operator': environment.Union, 'mixed': 'true', 'children': [{ 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveInterventionOrder', 'resultTypeLabel': 'Intervention, Order', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPalliative_or_Hospice_Care', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.600.1.1579', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPalliative or Hospice Care' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionPerformed' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionOrder' }] }] } }, { 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveInterventionPerformed', 'resultTypeLabel': 'Intervention, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPalliative_or_Hospice_Care', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.600.1.1579', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPalliative or Hospice Care' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionPerformed' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionOrder' }] }] } }] } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [42:1-47:202]
	define "Treatment for Opioid Use Disorders":
	  ( ["Medication, Active": "Medications for Opioid Use Disorder (MOUD)"]
	    union ["Medication, Order": "Medications for Opioid Use Disorder (MOUD)"] ) MedicationTreatment
	    with ["Intervention, Performed": "Opioid Medication Assisted Treatment (MAT)"] MAT
	      such that Coalesce(start of Global."NormalizeInterval"(MedicationTreatment.relevantDatetime, MedicationTreatment.relevantPeriod), MedicationTreatment.authorDatetime) during day of Global."NormalizeInterval" ( MAT.relevantDatetime, MAT.relevantPeriod )
	        and Coalesce(start of Global."NormalizeInterval"(MedicationTreatment.relevantDatetime, MedicationTreatment.relevantPeriod), MedicationTreatment.authorDatetime) during day of "Measurement Period"
*/
{% macro SafeUseofOpioidsConcurrentPrescribingTreatment_for_Opioid_Use_Disorders(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingTreatment for Opioid Use Disorders', 'child': { 'operator': environment.Query, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'MedicationTreatment', 'child': { 'operator': environment.Union, 'mixed': 'true', 'children': [{ 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Medication, Active', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingMedications_for_Opioid_Use_Disorder__LP_MOUD_RP_', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.269', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingMedications for Opioid Use Disorder (MOUD)' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveMedicationOrder' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}MedicationActive' }] }] } }, { 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationOrder', 'resultTypeLabel': 'Medication, Order', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingMedications_for_Opioid_Use_Disorder__LP_MOUD_RP_', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.269', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingMedications for Opioid Use Disorder (MOUD)' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveMedicationOrder' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}MedicationActive' }] }] } }] } }], 'relationshipClauseList': [{ 'operator': environment.With, 'alias': 'MAT', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveInterventionPerformed', 'resultTypeLabel': 'Intervention, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingOpioid_Medication_Assisted_Treatment__LP_MAT_RP_', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.177', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingOpioid Medication Assisted Treatment (MAT)' } } }, 'suchThat': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantPeriod' }] } }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'authorDatetime' }] }, 'right': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'MAT', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'MAT', 'path': 'relevantPeriod' }] } }, 'right': { 'operator': environment.InInterval, 'left': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantPeriod' }] } }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'authorDatetime' }] }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } } } }] } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [49:1-50:51]
	define "SDE Ethnicity":
	  ["Patient Characteristic Ethnicity": "Ethnicity"]
*/
{% macro SafeUseofOpioidsConcurrentPrescribingSDE_Ethnicity(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSDE Ethnicity', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Patient Characteristic Ethnicity', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingEthnicity', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.114222.4.11.837', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingEthnicity' } } } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [52:1-53:41]
	define "SDE Race":
	  ["Patient Characteristic Race": "Race"]
*/
{% macro SafeUseofOpioidsConcurrentPrescribingSDE_Race(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSDE Race', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Patient Characteristic Race', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingRace', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.114222.4.11.836', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingRace' } } } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [55:1-56:58]
	define "SDE Sex":
	  ["Patient Characteristic Sex": "ONC Administrative Sex"]
*/
{% macro SafeUseofOpioidsConcurrentPrescribingSDE_Sex(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSDE Sex', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Patient Characteristic Sex', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingONC_Administrative_Sex', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingONC Administrative Sex' } } } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [58:1-59:48]
	define "SDE Payer":
	  ["Patient Characteristic Payer": "Payer Type"]
*/
{% macro SafeUseofOpioidsConcurrentPrescribingSDE_Payer(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSDE Payer', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Patient Characteristic Payer', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPayer_Type', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.114222.4.11.3591', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPayer Type' } } } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [61:1-87:7]
	define "Denominator Exclusion":
	  /*Excludes encounters of patients with cancer pain or who are receiving palliative or hospice care at the time of the encounter or who are receiving medication for opioid use disorder, have sickle cell disease, or who are discharged to another inpatient care facility or discharged against medical advice, or expire during the inpatient stay*/
	  
	  "Inpatient Encounters with an Opioid or Benzodiazepine at Discharge" InpatientEncounter
	    where exists ( ["Diagnosis": "Cancer Related Pain"] Cancer
	        where Cancer.prevalencePeriod overlaps day of InpatientEncounter.relevantPeriod
	    )
	      or exists ( ["Diagnosis": "Sickle Cell Disease with and without Crisis"] SickleCellDisease
	          where SickleCellDisease.prevalencePeriod overlaps InpatientEncounter.relevantPeriod
	      )
	      or exists ( InpatientEncounter.diagnoses Diagnosis
	          where Diagnosis.code in "Cancer Related Pain"
	      )
	      or exists ( ["Diagnosis": "Opioid Use Disorder"] OUD
	          where start of OUD.prevalencePeriod before day of end of InpatientEncounter.relevantPeriod
	      )
	      or exists ( "Treatment for Opioid Use Disorders" OUDTreatment
	          where Coalesce(start of Global."NormalizeInterval"(OUDTreatment.relevantDatetime, OUDTreatment.relevantPeriod), OUDTreatment.authorDatetime) during day of InpatientEncounter.relevantPeriod
	      )
	      or exists ( "Intervention Palliative or Hospice Care" PalliativeOrHospiceCare
	          where Coalesce(start of Global."NormalizeInterval"(PalliativeOrHospiceCare.relevantDatetime, PalliativeOrHospiceCare.relevantPeriod), PalliativeOrHospiceCare.authorDatetime) during Global."HospitalizationWithObservation" ( InpatientEncounter )
	      )
	      or ( InpatientEncounter.dischargeDisposition in "Discharge To Acute Care Facility"
	          or InpatientEncounter.dischargeDisposition in "Hospice Care Referral or Admission"
	          or InpatientEncounter.dischargeDisposition in "Patient Expired"
	          or InpatientEncounter.dischargeDisposition in "Left Against Medical Advice"
	      )
*/
{% macro SafeUseofOpioidsConcurrentPrescribingDenominator_Exclusion(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingDenominator Exclusion', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.Or, 'left': { 'operator': environment.Or, 'left': { 'operator': environment.Or, 'left': { 'operator': environment.Or, 'left': { 'operator': environment.Or, 'left': { 'operator': environment.Or, 'left': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.Overlaps, 'left': { 'operator': environment.Property, 'scope': 'Cancer', 'path': 'prevalencePeriod' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Cancer', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Diagnosis', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingCancer_Related_Pain', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.180', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingCancer Related Pain' } } } }] } }, 'right': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.Overlaps, 'left': { 'operator': environment.Property, 'scope': 'SickleCellDisease', 'path': 'prevalencePeriod' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'SickleCellDisease', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Diagnosis', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSickle_Cell_Disease_with_and_without_Crisis', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.175', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSickle Cell Disease with and without Crisis' } } } }] } } }, 'right': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'Diagnosis', 'path': 'code' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingCancer_Related_Pain', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.180', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingCancer Related Pain' } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Diagnosis', 'child': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'diagnoses' } }] } } }, 'right': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.Before, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'OUD', 'path': 'prevalencePeriod' } }, 'right': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'OUD', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Diagnosis', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingOpioid_Use_Disorder', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.171', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingOpioid Use Disorder' } } } }] } } }, 'right': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'OUDTreatment', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'OUDTreatment', 'path': 'relevantPeriod' }] } }, { 'operator': environment.Property, 'scope': 'OUDTreatment', 'path': 'authorDatetime' }] }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'OUDTreatment', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingTreatment_for_Opioid_Use_Disorders', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingTreatment for Opioid Use Disorders', 'child': { 'operator': environment.Query, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'MedicationTreatment', 'child': { 'operator': environment.Union, 'mixed': 'true', 'children': [{ 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': none, 'resultTypeLabel': 'Medication, Active', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingMedications_for_Opioid_Use_Disorder__LP_MOUD_RP_', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.269', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingMedications for Opioid Use Disorder (MOUD)' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveMedicationOrder' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}MedicationActive' }] }] } }, { 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationOrder', 'resultTypeLabel': 'Medication, Order', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingMedications_for_Opioid_Use_Disorder__LP_MOUD_RP_', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.269', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingMedications for Opioid Use Disorder (MOUD)' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveMedicationOrder' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}MedicationActive' }] }] } }] } }], 'relationshipClauseList': [{ 'operator': environment.With, 'alias': 'MAT', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveInterventionPerformed', 'resultTypeLabel': 'Intervention, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingOpioid_Medication_Assisted_Treatment__LP_MAT_RP_', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.177', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingOpioid Medication Assisted Treatment (MAT)' } } }, 'suchThat': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantPeriod' }] } }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'authorDatetime' }] }, 'right': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'MAT', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'MAT', 'path': 'relevantPeriod' }] } }, 'right': { 'operator': environment.InInterval, 'left': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'relevantPeriod' }] } }, { 'operator': environment.Property, 'scope': 'MedicationTreatment', 'path': 'authorDatetime' }] }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } } } }] } } } }] } } }, 'right': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMNormalizeInterval', 'child': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } } }, 'then': { 'operator': environment.Interval, 'high': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } }, 'low': { 'operator': environment.OperandRef, 'referencedName': 'pointInTime', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } } } }, 'else': { 'operator': environment.If, 'condition': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } } }, 'then': { 'operator': environment.OperandRef, 'referencedName': 'period', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } }, 'else': { 'operator': environment.As, 'child': { 'operator': environment.Null }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } } } }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'pointInTime', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' } }, { 'operator': environment.OperandDef, 'referenceName': 'period', 'child': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] } }] }, 'children': [{ 'operator': environment.Property, 'scope': 'PalliativeOrHospiceCare', 'path': 'relevantDatetime' }, { 'operator': environment.Property, 'scope': 'PalliativeOrHospiceCare', 'path': 'relevantPeriod' }] } }, { 'operator': environment.Property, 'scope': 'PalliativeOrHospiceCare', 'path': 'authorDatetime' }] }, 'right': { 'operator': environment.FunctionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMHospitalizationWithObservation', 'referenceTo': { 'operator': environment.FunctionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMHospitalizationWithObservation', 'child': { 'operator': environment.Query, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Interval, 'high': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'EDVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } } } } }, { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Visit', 'child': { 'operator': environment.OperandRef, 'referencedName': 'Encounter', 'referenceTo': { 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } } } }], 'letClauseList': [{ 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } }, { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } }, { 'operator': environment.LetClause, 'referenceName': 'EDVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastED', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'VisitStart', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'VisitStart', 'child': { 'operator': environment.Coalesce, 'children': [{ 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'relevantPeriod', 'child': { 'operator': environment.QueryLetRef, 'referencedName': 'ObsVisit', 'referenceTo': { 'operator': environment.LetClause, 'referenceName': 'ObsVisit', 'child': { 'operator': environment.Last, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'LastObs', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Interval, 'high': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'low': { 'operator': environment.Subtract, 'left': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Quantity, 'unit': 'hour', 'value': '1' } } } }, 'right': { 'operator': environment.Not, 'child': { 'operator': environment.IsNull, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastObs', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMObservation_Services', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1111.143', 'referenceName': 'MATGlobalCommonFunctionsQDMObservation Services' } } } }] } } } } } }, { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'Visit', 'path': 'relevantPeriod' } }] } } } } } }, 'sortClause': { 'operator': environment.SortClause, 'children': [{ 'operator': environment.ByExpression, 'direction': 'ASC', 'child': { 'operator': environment.End, 'child': { 'operator': environment.IdentifierRef, 'referencedName': 'relevantPeriod', 'resultType': 'interval<System.DateTime>' } } }] }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'LastED', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEmergency_Department_Visit', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.292', 'referenceName': 'MATGlobalCommonFunctionsQDMEmergency Department Visit' } } } }] } } }] }, 'typeSpecifier': { 'operator': environment.IntervalTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:hl7-org:elm-types:r1}DateTime' }] }, 'arguments': [{ 'operator': environment.OperandDef, 'referenceName': 'Encounter', 'child': { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveEncounterPerformed' } }] }, 'children': [{ 'operator': environment.AliasRef, 'referencedName': 'InpatientEncounter' }] } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'PalliativeOrHospiceCare', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingIntervention_Palliative_or_Hospice_Care', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingIntervention Palliative or Hospice Care', 'child': { 'operator': environment.Union, 'mixed': 'true', 'children': [{ 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveInterventionOrder', 'resultTypeLabel': 'Intervention, Order', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPalliative_or_Hospice_Care', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.600.1.1579', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPalliative or Hospice Care' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionPerformed' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionOrder' }] }] } }, { 'operator': environment.As, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveInterventionPerformed', 'resultTypeLabel': 'Intervention, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPalliative_or_Hospice_Care', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.600.1.1579', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPalliative or Hospice Care' } } }, 'typeSpecifier': { 'operator': environment.ListTypeSpecifier, 'children': [{ 'operator': environment.ChoiceTypeSpecifier, 'children': [{ 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionPerformed' }, { 'operator': environment.NamedTypeSpecifier, 'name': '{urn:healthit-gov:qdm:v5_6}PositiveInterventionOrder' }] }] } }] } } } }], 'aliasRefNodeList': [{ 'operator': environment.AliasRef, 'referencedName': 'InpatientEncounter' }] } } }, 'right': { 'operator': environment.Or, 'left': { 'operator': environment.Or, 'left': { 'operator': environment.Or, 'left': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'dischargeDisposition' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingDischarge_To_Acute_Care_Facility', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.87', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingDischarge To Acute Care Facility' } } }, 'right': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'dischargeDisposition' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingHospice_Care_Referral_or_Admission', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1116.365', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingHospice Care Referral or Admission' } } } }, 'right': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'dischargeDisposition' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPatient_Expired', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.309', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient Expired' } } } }, 'right': { 'operator': environment.InValueSet, 'child': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'dischargeDisposition' }, 'valueSetReference': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingLeft_Against_Medical_Advice', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.117.1.7.1.308', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingLeft Against Medical Advice' } } } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounters_with_an_Opioid_or_Benzodiazepine_at_Discharge', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounters with an Opioid or Benzodiazepine at Discharge', 'child': { 'operator': environment.Query, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounter_with_Age_Greater_than_or_Equal_to_18', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounter with Age Greater than or Equal to 18', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.GreaterOrEqual, 'left': { 'operator': environment.CalculateAgeAt, 'left': { 'operator': environment.ToDate, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'birthDatetime', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } } } } }, 'right': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'InpatientHospitalEncounter', 'path': 'relevantPeriod' } } } }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '18' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientHospitalEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMInpatient_Encounter', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' } } } }] } } } }] } } } }], 'relationshipClauseList': [{ 'operator': environment.With, 'alias': 'OpioidOrBenzodiazepineDischargeMedication', 'child': { 'operator': environment.Union, 'mixed': 'false', 'children': [{ 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' } } }, { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_IV_Benzodiazepines', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1125.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule IV Benzodiazepines' } } }] }, 'suchThat': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'OpioidOrBenzodiazepineDischargeMedication', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } } }] } } } }] } }) }}{% endmacro %}
/*
	// SafeUseofOpioidsConcurrentPrescribing lines [97:1-112:3]
	define "Numerator":
	  /*Encounters of patients prescribed two or more opioids or an opioid and benzodiazepine at discharge.
	  */
	  
	  ( "Inpatient Encounters with an Opioid or Benzodiazepine at Discharge" InpatientEncounter
	      where ( Count(["Medication, Discharge": "Schedule II, III and IV Opioid Medications"] Opioids
	            where Opioids.authorDatetime during day of InpatientEncounter.relevantPeriod
	            return distinct Opioids.code
	        ) >= 2
	      )
	        or exists ( ["Medication, Discharge": "Schedule II, III and IV Opioid Medications"] OpioidsDischarge
	            where OpioidsDischarge.authorDatetime during day of InpatientEncounter.relevantPeriod
	              and exists ["Medication, Discharge": "Schedule IV Benzodiazepines"] BenzodiazepinesDischarge
	                where BenzodiazepinesDischarge.authorDatetime during day of InpatientEncounter.relevantPeriod
	        )
	  )
*/
{% macro SafeUseofOpioidsConcurrentPrescribingNumerator(environment, state) %}{{ environment.OperatorHandler.print(environment, environment.OperatorHandler, state, { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingNumerator', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.Or, 'left': { 'operator': environment.GreaterOrEqual, 'left': { 'operator': environment.Count, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'Opioids', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } }, 'returnClause': { 'operator': environment.ReturnClause, 'child': { 'operator': environment.Property, 'scope': 'Opioids', 'path': 'code' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'Opioids', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' } } } }] } }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '2' } }, 'right': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.And, 'left': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'OpioidsDischarge', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.Exists, 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'BenzodiazepinesDischarge', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'BenzodiazepinesDischarge', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_IV_Benzodiazepines', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1125.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule IV Benzodiazepines' } } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'OpioidsDischarge', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' } } } }] } } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounters_with_an_Opioid_or_Benzodiazepine_at_Discharge', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounters with an Opioid or Benzodiazepine at Discharge', 'child': { 'operator': environment.Query, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingInpatient_Encounter_with_Age_Greater_than_or_Equal_to_18', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingInpatient Encounter with Age Greater than or Equal to 18', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.GreaterOrEqual, 'left': { 'operator': environment.CalculateAgeAt, 'left': { 'operator': environment.ToDate, 'child': { 'operator': environment.Property, 'scope': none, 'path': 'birthDatetime', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingPatient', 'child': { 'operator': environment.SingletonFrom, 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'Patient', 'resultTypeLabel': none, 'codeComparator': none, 'codeProperty': none, 'codeSearch': none, 'valueSetProperty': none } } } } } }, 'right': { 'operator': environment.DateFrom, 'child': { 'operator': environment.Start, 'child': { 'operator': environment.Property, 'scope': 'InpatientHospitalEncounter', 'path': 'relevantPeriod' } } } }, 'right': { 'operator': environment.Literal, 'type': 'Integer', 'value': '18' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'InpatientHospitalEncounter', 'child': { 'operator': environment.ExpressionRef, 'referencedName': 'MATGlobalCommonFunctionsQDMInpatient_Encounter', 'referenceTo': { 'operator': environment.ExpressionDef, 'context': 'Patient', 'referenceName': 'MATGlobalCommonFunctionsQDMInpatient Encounter', 'child': { 'operator': environment.Query, 'where': { 'operator': environment.InInterval, 'left': { 'operator': environment.End, 'child': { 'operator': environment.Property, 'scope': 'EncounterInpatient', 'path': 'relevantPeriod' } }, 'right': { 'operator': environment.ParameterRef, 'name': 'Measurement_Period' } }, 'aliasedQuerySources': [{ 'operator': environment.AliasedQuerySource, 'alias': 'EncounterInpatient', 'child': { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveEncounterPerformed', 'resultTypeLabel': 'Encounter, Performed', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'MATGlobalCommonFunctionsQDMEncounter_Inpatient', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113883.3.666.5.307', 'referenceName': 'MATGlobalCommonFunctionsQDMEncounter Inpatient' } } } }] } } } }] } } } }], 'relationshipClauseList': [{ 'operator': environment.With, 'alias': 'OpioidOrBenzodiazepineDischargeMedication', 'child': { 'operator': environment.Union, 'mixed': 'false', 'children': [{ 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_II_COMMA__III_and_IV_Opioid_Medications', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1046.241', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule II, III and IV Opioid Medications' } } }, { 'operator': environment.Retrieve, 'modelType': 'urn:healthit-gov:qdm:v5_6', 'templateId': 'PositiveMedicationDischarge', 'resultTypeLabel': 'Medication, Discharge', 'codeComparator': 'in', 'codeProperty': 'code', 'codeSearch': none, 'valueSetProperty': none, 'valueSet': { 'operator': environment.ValueSetRef, 'referencedName': 'SafeUseofOpioidsConcurrentPrescribingSchedule_IV_Benzodiazepines', 'referenceTo': { 'operator': environment.ValueSetDef, 'value': 'urn:oid:2.16.840.1.113762.1.4.1125.1', 'referenceName': 'SafeUseofOpioidsConcurrentPrescribingSchedule IV Benzodiazepines' } } }] }, 'suchThat': { 'operator': environment.InInterval, 'left': { 'operator': environment.Property, 'scope': 'OpioidOrBenzodiazepineDischargeMedication', 'path': 'authorDatetime' }, 'right': { 'operator': environment.Property, 'scope': 'InpatientEncounter', 'path': 'relevantPeriod' } } }] } } } }] } }) }}{% endmacro %}
